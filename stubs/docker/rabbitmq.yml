# Docker Compose configuration for RabbitMQ Message Broker
# Generated by PhpHive CLI
#
# RabbitMQ is a full-featured message broker with:
# - Multiple exchanges and queues
# - Message routing and persistence
# - Dead letter queues
# - Management UI for monitoring
#
# Usage:
#   docker compose up -d    # Start RabbitMQ
#   docker compose down     # Stop RabbitMQ
#   docker compose logs rabbitmq  # View logs
#
# Access:
#   AMQP Protocol: localhost:5672
#   Management UI: http://localhost:15672
#   Default credentials: guest/guest (configurable)

version: "3.8"

services:
  # RabbitMQ Message Broker Service
  rabbitmq:
    image: rabbitmq:3-management-alpine
    container_name: "{{CONTAINER_PREFIX}}-rabbitmq"
    restart: unless-stopped
    environment:
      RABBITMQ_DEFAULT_USER: "{{RABBITMQ_USER}}"
      RABBITMQ_DEFAULT_PASS: "{{RABBITMQ_PASSWORD}}"
      RABBITMQ_DEFAULT_VHOST: "{{RABBITMQ_VHOST}}"
    ports:
      - "{{RABBITMQ_PORT}}:5672" # AMQP protocol port
      - "{{RABBITMQ_MANAGEMENT_PORT}}:15672" # Management UI port
    volumes:
      - "{{VOLUME_PREFIX}}-rabbitmq-data:/var/lib/rabbitmq"
      - "{{VOLUME_PREFIX}}-rabbitmq-log:/var/log/rabbitmq"
    networks:
      - "{{NETWORK_NAME}}"
    healthcheck:
      test: ["CMD", "rabbitmq-diagnostics", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 30s

# Named volumes for data persistence
volumes:
  "{{VOLUME_PREFIX}}-rabbitmq-data":
    driver: local
  "{{VOLUME_PREFIX}}-rabbitmq-log":
    driver: local

# Network for service communication
networks:
  "{{NETWORK_NAME}}":
    driver: bridge
